<div>
  <div class="flex justify-between items-center mb-6">
    <div>
      <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Team Members</h1>
      <p class="text-gray-600 dark:text-zinc-400 mt-1">Manage team members for <%= @team.name %>.</p>
    </div>
    <%= link_to team_path(@team), class: "text-sm text-gray-600 dark:text-zinc-400 hover:text-gray-900 dark:hover:text-white" do %>
      Back to team
    <% end %>
  </div>

  <% if can_manage_team_assignment?(@team) %>
    <div class="bg-white dark:bg-zinc-800 shadow dark:shadow-zinc-700/50 rounded-lg border border-transparent dark:border-zinc-700 p-6">
      <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Add Member</h2>
      <%= form_with url: team_team_members_path(@team), method: :post, class: "space-y-4" do |form| %>
        <div>
          <%= form.label :email_address, "Email address", class: "block text-sm font-medium text-gray-700 dark:text-zinc-300 mb-1.5" %>
          <%= form.email_field :email_address, required: true, class: "block w-full px-3 py-2 bg-white dark:bg-zinc-900 border border-gray-300 dark:border-zinc-700 rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-1 focus:border-violet-500 focus:ring-violet-500" %>
        </div>
        <div>
          <%= form.label :role, "Role", class: "block text-sm font-medium text-gray-700 dark:text-zinc-300 mb-1.5" %>
          <%= form.select :role,
              [["Viewer", "viewer"], ["Member", "member"], ["Developer", "developer"], ["Admin", "admin"], ["Owner", "owner"]],
              { selected: "member" },
              { class: "block w-full px-3 py-2 bg-white dark:bg-zinc-900 border border-gray-300 dark:border-zinc-700 rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-1 focus:border-violet-500 focus:ring-violet-500" } %>
          <p class="mt-1 text-xs text-gray-500 dark:text-zinc-400">
            <strong>Viewer:</strong> Read-only access.
            <strong>Member:</strong> Can update problems.
            <strong>Developer:</strong> Can edit apps.
            <strong>Admin:</strong> Can delete and manage team.
            <strong>Owner:</strong> Full control.
          </p>
        </div>
        <%= form.submit "Add Member", class: "px-4 py-2 bg-violet-600 text-white rounded-lg font-medium hover:bg-violet-500 focus:outline-none focus:ring-2 focus:ring-violet-500 transition-colors cursor-pointer" %>
      <% end %>
    </div>
  <% end %>

  <div class="mt-6 bg-white dark:bg-zinc-800 shadow dark:shadow-zinc-700/50 rounded-lg border border-transparent dark:border-zinc-700 p-6">
    <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Current Members</h2>
    <div class="space-y-3">
      <% @team_members.each do |member| %>
        <div class="flex items-center justify-between p-3 rounded-lg border border-gray-200 dark:border-zinc-700">
          <div class="flex items-center space-x-3">
            <div class="flex-shrink-0 w-10 h-10 bg-violet-100 dark:bg-violet-500/20 rounded-full flex items-center justify-center">
              <span class="text-sm font-medium text-violet-600 dark:text-violet-400"><%= member.user.email_address[0].upcase %></span>
            </div>
            <div>
              <p class="text-sm font-medium text-gray-900 dark:text-white"><%= member.user.email_address %></p>
              <% if can_manage_team_assignment?(@team) && member.user != Current.user %>
                <%= form_with url: team_team_member_path(@team, member), method: :patch, class: "mt-1", data: { controller: "auto-submit" } do |form| %>
                  <%= form.select :role,
                      [["Viewer", "viewer"], ["Member", "member"], ["Developer", "developer"], ["Admin", "admin"], ["Owner", "owner"]],
                      { selected: member.role },
                      { class: "text-xs px-2 py-0.5 bg-white dark:bg-zinc-900 border border-gray-300 dark:border-zinc-700 rounded text-gray-700 dark:text-zinc-300 focus:outline-none focus:ring-1 focus:border-violet-500 focus:ring-violet-500",
                        data: { action: "change->auto-submit#submit" } } %>
                <% end %>
              <% else %>
                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium <%= role_badge_class(member.role) %>">
                  <%= member.role.capitalize %>
                </span>
              <% end %>
            </div>
          </div>
          <div class="flex items-center space-x-2">
            <% if can_manage_team_assignment?(@team) %>
              <%= link_to edit_team_team_member_permissions_path(@team, member),
                  class: "inline-flex items-center px-3 py-1.5 text-sm font-medium text-gray-700 dark:text-zinc-300 bg-gray-100 dark:bg-zinc-700 rounded-lg hover:bg-gray-200 dark:hover:bg-zinc-600 transition-colors",
                  data: { turbo_frame: "slide_over" } do %>
                <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                </svg>
                Permissions
              <% end %>
            <% end %>
            <% if can_manage_team_assignment?(@team) && member.user != Current.user %>
              <%= button_to team_team_member_path(@team, member), method: :delete, data: { turbo_confirm: "Remove this member from the team?" }, class: "inline-flex items-center px-3 py-1.5 text-sm font-medium text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-500/10 rounded-lg hover:bg-red-100 dark:hover:bg-red-500/20 transition-colors" do %>
                Remove
              <% end %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>

<%= turbo_frame_tag "slide_over" %>

