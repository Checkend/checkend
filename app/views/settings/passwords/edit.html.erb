<%= turbo_frame_tag "modal" do %>
  <%= render layout: "shared/slide_over", locals: { title: "Change Password", subtitle: "Update your password to keep your account secure." } do %>
    <%= form_with url: settings_password_path,
                  method: :patch,
                  class: "flex flex-col h-full",
                  data: {
                    controller: "password-form",
                    password_form_verify_url_value: verify_settings_password_path
                  } do |form| %>
      <%# Scrollable form content %>
      <div class="flex-1 overflow-y-auto px-4 py-6 sm:px-6 space-y-6">
        <div>
          <%= form.label :current_password, "Current Password", class: "block text-sm font-medium text-gray-700 dark:text-zinc-300 mb-1.5" %>
          <div class="relative">
            <%= form.password_field :current_password,
                required: true,
                autocomplete: "current-password",
                data: { password_form_target: "currentPassword", action: "input->password-form#checkCurrentPassword" },
                class: "block w-full px-3 py-2 pr-10 bg-white dark:bg-zinc-900 border border-gray-300 dark:border-zinc-700 rounded-lg text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-zinc-500 focus:outline-none focus:border-violet-500 focus:ring-1 focus:ring-violet-500 transition-colors" %>
            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3" data-password-form-target="currentPasswordIcon"></div>
          </div>
        </div>

        <div>
          <%= form.label :password, "New Password", class: "block text-sm font-medium text-gray-700 dark:text-zinc-300 mb-1.5" %>
          <div class="relative">
            <%= form.password_field :password,
                required: true,
                autocomplete: "new-password",
                minlength: 8,
                data: { password_form_target: "newPassword", action: "input->password-form#validateNewPassword" },
                class: "block w-full px-3 py-2 pr-10 bg-white dark:bg-zinc-900 border border-gray-300 dark:border-zinc-700 rounded-lg text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-zinc-500 focus:outline-none focus:border-violet-500 focus:ring-1 focus:ring-violet-500 transition-colors" %>
            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3" data-password-form-target="newPasswordIcon"></div>
          </div>
          <p class="mt-1 text-sm text-gray-500 dark:text-zinc-500">Minimum 8 characters. Cannot reuse your last 5 passwords.</p>
        </div>

        <div>
          <%= form.label :password_confirmation, "Confirm New Password", class: "block text-sm font-medium text-gray-700 dark:text-zinc-300 mb-1.5" %>
          <div class="relative">
            <%= form.password_field :password_confirmation,
                required: true,
                autocomplete: "new-password",
                data: { password_form_target: "confirmPassword", action: "input->password-form#validateConfirmPassword" },
                class: "block w-full px-3 py-2 pr-10 bg-white dark:bg-zinc-900 border border-gray-300 dark:border-zinc-700 rounded-lg text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-zinc-500 focus:outline-none focus:border-violet-500 focus:ring-1 focus:ring-violet-500 transition-colors" %>
            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3" data-password-form-target="confirmPasswordIcon"></div>
          </div>
        </div>
      </div>

      <%# Sticky footer with action buttons %>
      <div class="flex-shrink-0 flex items-center justify-end space-x-3 px-4 py-4 sm:px-6 border-t border-gray-200 dark:border-zinc-700 bg-gray-50 dark:bg-zinc-800/50">
        <button type="button"
                @click="slideOverOpen = false"
                class="px-4 py-2 text-gray-700 dark:text-zinc-300 hover:text-gray-900 dark:hover:text-white font-medium transition-colors">
          Cancel
        </button>
        <%= form.submit "Update Password",
            data: { password_form_target: "submitButton" },
            disabled: true,
            class: "px-4 py-2 bg-violet-600 text-white rounded-lg font-medium focus:outline-none focus:ring-2 focus:ring-violet-500 focus:ring-offset-2 dark:focus:ring-offset-zinc-900 transition-colors cursor-pointer opacity-50 cursor-not-allowed" %>
      </div>
    <% end %>
  <% end %>
<% end %>
