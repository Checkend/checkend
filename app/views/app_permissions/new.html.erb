<%= turbo_frame_tag "slide_over" do %>
  <div x-data="{ slideOverOpen: false }">
    <%= render "shared/slide_over", title: "Grant Access", subtitle: @app.name do %>
      <%= form_with url: app_permissions_path(@app), method: :post, class: "flex-1 flex flex-col overflow-hidden" do |form| %>
        <div class="flex-1 overflow-y-auto px-4 py-6 sm:px-6">
          <%# User Selection %>
          <div class="mb-6">
            <h3 class="text-sm font-medium text-gray-900 dark:text-white mb-3">Select User</h3>
            <div class="relative">
              <%= form.select :user_id,
                  options_from_collection_for_select(@users, :id, :email_address),
                  { include_blank: "Choose a user..." },
                  { class: "block w-full px-3 py-2 bg-white dark:bg-zinc-900 border border-gray-300 dark:border-zinc-700 rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-1 focus:border-violet-500 focus:ring-violet-500", required: true } %>
            </div>
            <p class="mt-1 text-xs text-gray-500 dark:text-zinc-400">Grant direct access to this app for the selected user.</p>
          </div>

          <%# Permissions Selection %>
          <div class="mb-6">
            <h3 class="text-sm font-medium text-gray-900 dark:text-white mb-3">Permissions to Grant</h3>
            <div class="space-y-3">
              <% @permissions.each do |perm| %>
                <label class="flex items-start">
                  <input type="checkbox" name="permission_ids[]" value="<%= perm.id %>"
                         class="mt-0.5 rounded border-gray-300 dark:border-zinc-600 text-violet-600 focus:ring-violet-500 dark:bg-zinc-700">
                  <div class="ml-3">
                    <span class="text-sm font-medium text-gray-700 dark:text-zinc-300"><%= perm.key %></span>
                    <p class="text-xs text-gray-500 dark:text-zinc-400"><%= perm.description %></p>
                  </div>
                </label>
              <% end %>
            </div>
          </div>

          <%# Expiration %>
          <div class="mb-6">
            <h3 class="text-sm font-medium text-gray-900 dark:text-white mb-3">Access Duration</h3>
            <div class="relative">
              <%= form.select :expires_at,
                  [["Never expires", "never"], ["1 day", "1_day"], ["1 week", "1_week"], ["1 month", "1_month"], ["3 months", "3_months"]],
                  { selected: "never" },
                  { class: "block w-full px-3 py-2 bg-white dark:bg-zinc-900 border border-gray-300 dark:border-zinc-700 rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-1 focus:border-violet-500 focus:ring-violet-500" } %>
            </div>
            <p class="mt-1 text-xs text-gray-500 dark:text-zinc-400">Set an optional expiration for temporary access.</p>
          </div>

          <%# Info Box %>
          <div class="bg-blue-50 dark:bg-blue-500/10 rounded-lg p-4">
            <div class="flex">
              <svg class="w-5 h-5 text-blue-600 dark:text-blue-400 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <div class="text-sm text-blue-700 dark:text-blue-300">
                <p class="font-medium mb-1">About Direct Access</p>
                <p class="text-xs text-blue-600 dark:text-blue-400">Direct access grants permissions to a user regardless of their team membership. This is useful for granting temporary access to contractors or external collaborators.</p>
              </div>
            </div>
          </div>
        </div>

        <%# Footer %>
        <div class="flex-shrink-0 border-t border-gray-200 dark:border-zinc-700 px-4 py-4 sm:px-6">
          <div class="flex justify-end space-x-3">
            <%= link_to "Cancel", @app,
                class: "rounded-md bg-white dark:bg-zinc-800 px-3 py-2 text-sm font-semibold text-gray-900 dark:text-white shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-zinc-600 hover:bg-gray-50 dark:hover:bg-zinc-700" %>
            <%= form.submit "Grant Access",
                class: "rounded-md bg-violet-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-violet-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-violet-600 cursor-pointer" %>
          </div>
        </div>
      <% end %>
    <% end %>
  </div>
<% end %>
