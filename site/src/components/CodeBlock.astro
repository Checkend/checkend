---
interface Props {
  title?: string
  lang?: string
  code: string
}

const { title, lang = 'bash', code } = Astro.props
---

<div class="group relative my-6 overflow-hidden rounded-lg border border-zinc-700 bg-zinc-800 light:border-gray-200 light:bg-gray-900">
  {title && (
    <div class="border-b border-zinc-700 bg-zinc-800/50 px-4 py-2 light:border-gray-700 light:bg-gray-800/50">
      <span class="text-xs font-medium text-zinc-400 light:text-gray-400">{title}</span>
    </div>
  )}
  <div class="relative">
    <button
      class="copy-button absolute right-2 top-2 rounded-md bg-zinc-700 px-2 py-1 text-xs text-zinc-300 opacity-0 transition-opacity hover:bg-zinc-600 group-hover:opacity-100 light:bg-gray-700 light:text-gray-300 light:hover:bg-gray-600"
      data-copy
    >
      Copy
    </button>
    <pre class="overflow-x-auto p-4 text-sm text-zinc-100 light:text-gray-100"><code class={`language-${lang}`} set:text={code} /></pre>
  </div>
</div>

<script>
  document.querySelectorAll('[data-copy]').forEach((button) => {
    button.addEventListener('click', async () => {
      const pre = button.parentElement?.querySelector('pre');
      const code = pre?.textContent || '';

      try {
        await navigator.clipboard.writeText(code);
        button.textContent = 'Copied!';
        setTimeout(() => {
          button.textContent = 'Copy';
        }, 2000);
      } catch (err) {
        console.error('Failed to copy:', err);
      }
    });
  });
</script>
